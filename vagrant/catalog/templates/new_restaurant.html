{% extends 'base.html' %}

{% block body %}
<a id="back-btn" class="btn btn-lg btn-primary" href="/"><span class="glyphicon glyphicon-menu-left"></span><span class="glyphicon glyphicon-home"></span></a>
<div class="container" style="margin-top:50px">
    <div>
        <h1 data-bind="text: current_restaurant.name"></h1>
        <h3>Enter a new restaurant below.</h3>
        <div data-bind="with: current_restaurant">
            <div class="form-group">
                <label>Name</label>
                <input type="text" class="form-control" data-bind="textInput: name">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="text" class="form-control" data-bind="textInput: phone">
            </div>
            <div class="form-group">
                <label>Note</label>
                <input type="text" class="form-control" data-bind="textInput: note">
            </div>
        </div>
        <br>
        <button type="button" class="btn btn-success text-uppercase" data-bind="click: submit">Save new restaurant</button>
        <a class="btn btn-danger text-uppercase" href="{{ url_for('restaurants') }}">Cancel new restaurant</a>
    </div>
</div>

<script>
var view_model = view_model || {};

/**
 * KO observable model for new restaurant.
 */
view_model.current_restaurant = {
    name: ko.observable('{{ restaurant.name }}'),
    phone: ko.observable('{{ restaurant.phone }}'),
    note: ko.observable('{{ restaurant.note }}'),
};

/**
 * Add restaurant ID if provided for editing existing record.
 */
var restaurant_id = parseInt('{{ restaurant.id }}');
if (!isNaN(restaurant_id)) {
    view_model.current_restaurant.id = restaurant_id;
}

/**
 * Send data to server for saving.
 */
view_model.submit = function() {
    // Convert current_restaurant KO model to serializable object.
    var params = {
        _csrf: view_model._csrf,
        restaurant: ko.toJS(view_model.current_restaurant)
    };
    var callback = function(response) {
        // Go to restaurant menu view if successful.
        if (response.status == 'ok') {
            window.location = '/menu/' + response.id;
        } else {
            console.log(response.status);
            alert('There was a problem submitting the restaurant to the database.');
        }
    };
    if (params.restaurant.id) {
        post('/update/restaurant', params, callback);
    } else {
        post('/save/restaurant', params, callback);
    }
}
</script>

{% endblock %}